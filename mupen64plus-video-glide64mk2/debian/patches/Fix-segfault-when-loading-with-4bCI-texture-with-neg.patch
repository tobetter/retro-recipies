From: Richard Goedeken <Richard@fascinationsoftware.com>
Date: Fri, 1 May 2015 20:44:37 -0700
Subject: Fix segfault when loading with 4bCI texture with negative ext

Origin: upstream, https://github.com/mupen64plus/mupen64plus-video-glide64mk2/commit/15f1f888422e248c6f640e587dffd12eeb48764b
---
 src/Glide64/TexLoad4b.h | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/Glide64/TexLoad4b.h b/src/Glide64/TexLoad4b.h
index 814edad..58296fb 100644
--- a/src/Glide64/TexLoad4b.h
+++ b/src/Glide64/TexLoad4b.h
@@ -596,7 +596,7 @@ wxUint32 Load4bCI (wxUIntPtr dst, wxUIntPtr src, int wid_64, int height, int lin
 {
   if (wid_64 < 1) wid_64 = 1;
   if (height < 1) height = 1;
-  int ext = (real_width - (wid_64 << 4)) << 1;
+  int ext = (real_width - (wid_64 << 4));
 
   if (rdp.tlut_mode == 0)
   {
@@ -609,12 +609,13 @@ wxUint32 Load4bCI (wxUIntPtr dst, wxUIntPtr src, int wid_64, int height, int lin
   wxUIntPtr pal = wxPtrToUInt(rdp.pal_8 + (rdp.tiles[tile].palette << 4));
   if (rdp.tlut_mode == 2)
   {
+    ext <<= 1;
     load4bCI ((uint8_t *)src, (uint8_t *)dst, wid_64, height, line, ext, (uint16_t *)pal);
-    
     return (1 << 16) | GR_TEXFMT_ARGB_1555;
   }
 
-    load4bIAPal ((uint8_t *)src, (uint8_t *)dst, wid_64, height, line, ext, (uint16_t *)pal);
+  ext <<= 1;
+  load4bIAPal ((uint8_t *)src, (uint8_t *)dst, wid_64, height, line, ext, (uint16_t *)pal);
   return (1 << 16) | GR_TEXFMT_ALPHA_INTENSITY_88;
 }
 
